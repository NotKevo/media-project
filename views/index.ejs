<!DOCTYPE html>
<html>
  <head>
    <title><%= title %>: <%= subtitle %></title>
    <link rel="stylesheet" href="/stylesheets/style.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css"
      rel="stylesheet"
      crossorigin="anonymous"
    />
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.7/dist/gsap.min.js"></script>
  </head>
  <body>
    <form id="quizForm" action="/" method="post" target="_parent">
      <header>
        <progress max="10" value="2" id="progressBar"></progress>
        <span data-icon="⏱️" title="Time left">15</span>
        <span data-icon="🌟" title="Score">988</span>
      </header>
      <main>
        <fieldset>
          <legend>
            <h1><%= title %></h1>
            <h2><%= subtitle %></h2>
          </legend>
        </fieldset>
        <% for (let i = 0; i < questions.length; i++) { %>
        <fieldset>
          <legend><%= questions[i].question %></legend>
          <% for (let j = 0; j < questions[i].options.length; j++) { %>
            <% const questionId = questions[i].question.toLowerCase().replace(/[^_\w]+/g, '_').replace(/^_+|_+$/g, ''); %>
            <% const optionId = questions[i].options[j].toLowerCase().replace(/[^_\w]+/g, '_').replace(/^_+|_+$/g, ''); %>
          <label for="<%= questionId %>-<%= optionId %>">
            <%= questions[i].options[j] %>
            <input
              type="radio"
              accesskey="<%= j + 1 %>"
              name="<%= questionId %>"
              value="<%= optionId %>"
              id="<%= questionId %>-<%= optionId %>"
              required
            />
          </label>
          <input type="hidden" name="score-<%= questionId %>" value="0" id="score-<%= questionId %>"/>
          <input type="hidden" name="time-<%= questionId %>" value="0" id="time-<%= questionId %>" />
          <% } %>
        </fieldset>
        <% } %>
      </main>
      <footer>
        <button type="submit">Continue</button>
      </footer>
    </form>
    <aside>
      <h2>Performance</h2>
      <section>Your score compare to others, e.g. 988/1000</section>
      <section>Your mistakes compare to others, e.g. 4/10</section>
      <section>Your time compare to others, e.g. 300 seconds</section>
      <section>Your accuracy compare to others, e.g. 30% correct</section>
    </aside>
    <script>
      const progressBar = document.getElementById('progressBar');
      const timeLeft = document.querySelector('[data-icon="⏱️"]');
      const score = document.querySelector('[data-icon="🌟"]');
      const quizForm = document.getElementById('quizForm');

      let progress = 0;
      let time = 15;
      let currentScore = 988;
      const maxQuestions = 10;

      const updateProgress = () => {
        progress += 1;
        progressBar.value = progress;
      };

      const updateTime = () => {
        time -= 1;
        timeLeft.textContent = time;
        if (time <= 0) {
          quizForm.submit();
        }
      };

      const updateScore = (points) => {
        currentScore += points;
        score.textContent = currentScore;
      };

      setInterval(updateTime, 1000);

      quizForm.addEventListener('submit', (event) => {
        event.preventDefault();
        updateProgress();
        updateScore(10);
        if (progress < maxQuestions) {
          quizForm.submit();
        }
      });
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
